# JDK 8 G1GC Full GC 회피 벤치마크 분석 리포트

**테스트 일시**: 2026-01-05
**테스트 환경**: OpenJDK 1.8.0_432, G1GC, 힙 2GB
**목적**: Full GC 없이 안전하게 처리 가능한 최대 트래픽 수준 측정

---

## 1. 테스트 결과 요약

### 1.1 핵심 결론

```
┌──────────────────────────────────────────────────┐
│  최대 안전 동시접속: 25개                        │
│  권장 운영 동시접속: 20개 (80% 마진 적용)        │
│  달성 TPS: 114.60 req/s                         │
│  Full GC 발생: 0회                              │
└──────────────────────────────────────────────────┘
```

### 1.2 상세 측정 데이터

| 동시접속 | TPS | 평균(ms) | P99(ms) | Max(ms) | 힙(%) | Old GC | 상태 |
|---------|-----|---------|---------|---------|-------|--------|------|
| 5 | 56.40 | 51 | 89 | 116 | 35% | 0 | OK |
| 10 | 75.10 | 73 | 113 | 139 | 47% | 0 | OK |
| 15 | 87.20 | 98 | 171 | 248 | 63% | 0 | OK |
| 20 | 90.95 | 125 | 286 | 467 | 67% | 0 | OK |
| 25 | 114.60 | 124 | 306 | 458 | 78% | 0 | **경고** |
| 30 | 116.65 | 149 | 332 | 449 | 91% | 0 | **중단** |

---

## 2. 분석

### 2.1 TPS 분석

```
동시접속 증가에 따른 TPS 변화:
5개  → 56.40 req/s
10개 → 75.10 req/s (+33%)
15개 → 87.20 req/s (+16%)
20개 → 90.95 req/s (+4%)   ← TPS 증가율 둔화 시작
25개 → 114.60 req/s (+26%)
30개 → 116.65 req/s (+2%)  ← 포화 상태
```

**분석 결과**:
- 동시접속 20개까지는 TPS가 선형에 가깝게 증가
- 동시접속 25개 이상에서 TPS 증가율 급감 (포화 징후)
- 동시접속 30개에서 실질적인 TPS 증가 없음 → 시스템 한계 도달

### 2.2 응답시간 분석

```
P99 응답시간 추이:
동시접속 5개  → P99 89ms   (목표 200ms 이내)
동시접속 10개 → P99 113ms  (목표 이내)
동시접속 15개 → P99 171ms  (목표 이내)
동시접속 20개 → P99 286ms  (목표 초과!)
동시접속 25개 → P99 306ms  (목표 초과)
동시접속 30개 → P99 332ms  (목표 초과)
```

**분석 결과**:
- `MaxGCPauseMillis=200ms` 설정에도 불구하고 동시접속 20개부터 P99가 200ms 초과
- 이는 G1GC의 pause time 예측 실패를 의미
- 부하 증가 시 G1이 목표 pause time을 맞추지 못함

### 2.3 힙 사용률 분석

```
힙 사용률 추이 (최대 2GB):
동시접속 5개  → 35% (0.70GB)
동시접속 10개 → 47% (0.94GB)
동시접속 15개 → 63% (1.26GB)
동시접속 20개 → 67% (1.34GB)
동시접속 25개 → 78% (1.56GB) ← 경고 (70% 초과)
동시접속 30개 → 91% (1.82GB) ← 위험 (85% 초과)
```

**분석 결과**:
- 동시접속 25개에서 힙 78% 사용 → Full GC 임박 경고
- 동시접속 30개에서 힙 91% → Full GC 발생 직전 상태
- 2GB 힙으로는 동시접속 25개가 한계

### 2.4 GC 통계

```
Young GC: 23회, 총 899ms
Old GC: 0회 (Full GC 없음!)

평균 Young GC 시간: 899ms / 23회 = 39ms
```

**분석 결과**:
- Full GC가 발생하지 않아 P99 급등 방지 성공
- Young GC만으로 메모리 관리 → 이상적인 상태
- 하지만 힙이 91%까지 찼으므로 조금만 더 부하가 증가하면 Full GC 발생 예상

---

## 3. JDK 8 G1GC 특성 분석

### 3.1 왜 P99가 200ms를 초과하는가?

G1GC의 `MaxGCPauseMillis=200ms`는 **목표값**이지 **보장값이 아님**:

1. **예측 기반 동작**: G1은 과거 GC 데이터를 기반으로 다음 GC를 예측
2. **예측 실패**: 부하가 급변하면 예측 모델이 틀림
3. **부하 증가 시**:
   - Live 객체 증가 → 복사할 객체 증가
   - Region 수 증가 → 처리 시간 증가
   - 힙 압박 → 더 자주, 더 오래 GC

### 3.2 JDK 8 G1 Full GC의 위험성

```
JDK 8 G1 Full GC 특징:
- Single-threaded (단일 스레드)
- 힙 전체 스캔
- 수백ms ~ 수초 소요
- P99 latency 급등의 주범
```

이번 테스트에서는 Full GC가 발생하지 않았지만, 힙이 91%까지 찼으므로 **매우 위험한 상태**였음.

---

## 4. 권장사항

### 4.1 운영 환경 권장 설정

| 항목 | 권장값 | 근거 |
|------|--------|------|
| 최대 동시접속 | **20개** | 힙 67%, P99 286ms |
| 안전 동시접속 | **15개** | 힙 63%, P99 171ms |
| 힙 크기 | **4GB 이상** | 여유 공간 확보 |

### 4.2 힙 크기별 예상 처리량

| 힙 크기 | 예상 안전 동시접속 | 예상 TPS |
|---------|-------------------|----------|
| 2GB | 20개 | ~90 req/s |
| 4GB | 40개 | ~180 req/s |
| 8GB | 80개 | ~360 req/s |

### 4.3 모니터링 지표

운영 환경에서 반드시 모니터링해야 할 지표:

1. **힙 사용률**: 70% 초과 시 경고
2. **Old Gen GC 횟수**: 1회라도 발생하면 즉시 대응
3. **P99 응답시간**: 200ms 초과 시 경고
4. **Young GC 빈도**: 급격히 증가하면 Full GC 임박

---

## 5. 결론

### 5.1 테스트 결과 요약

- **2GB 힙, G1GC 환경에서 Full GC 없이 안전한 최대 동시접속은 20~25개**
- **P99 200ms 이내를 유지하려면 동시접속 15개 이하 권장**
- **힙 크기를 늘리면 더 많은 트래픽 처리 가능**

### 5.2 핵심 교훈

```
JDK 8 G1GC 운영 시 핵심 원칙:
1. Full GC는 절대 발생시키지 않는다
2. 힙 사용률 70% 이하 유지
3. MaxGCPauseMillis는 목표일 뿐, 믿지 않는다
4. P99를 기준으로 용량 산정
```

---

## 부록: 테스트 환경

```
JVM: OpenJDK 1.8.0_432 (Temurin)
GC: G1GC
힙: -Xms2g -Xmx2g
G1 설정:
  -XX:MaxGCPauseMillis=200
  -XX:G1HeapRegionSize=16m
  -XX:InitiatingHeapOccupancyPercent=45
  -XX:G1ReservePercent=10

워크로드: /allocate (1-5KB 객체 10-50개 할당)
테스트 시간: 단계별 20초
CPU: 10 cores
```
